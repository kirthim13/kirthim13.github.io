<!DOCTYPE html>
<meta charset="utf-8">
<style>
	.axis--x path {
		display: none;
	}
</style>
<svg style = "margin-left: 20px;" width="1000" height="500"></svg>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script>
	var svg = d3.select("svg"),
		margin = {top: 20, right: 20, bottom: 30, left: 40},
		width = +svg.attr("width") - margin.left - margin.right,
		height = +svg.attr("height") - margin.top - margin.bottom;
		
	var xAxis = d3.scaleBand().rangeRound([0, width]).paddingInner(0.5).paddingOuter(0.2),
		yAxis = d3.scaleLinear().rangeRound([height, 0]);	
	var duration = 2000;
	var fontSize = "12px";
	var fruitBarWidth = 30;
	var fruitBarPadding = 26;
	var dataset = null;
	var arc = null;
	
	var color = function(fruit) { 
					c = {	
						Apple:"#ff0000",
						Pear: "#bfff00",
						Orange: "#ff8000",
						Cherry: "#ff4545",
						Blueberry: "#536b98",
						Banana: "#FFE135",
						Peach: "#FFDAB9",
						Lemon: "#fff44f",
						Watermelon: "#FC6C85",
						Lime: "#00FF00",
						Mango: "#FF8243",
						Grape: "#421C52",
						Kiwi: "#80ff00",
						Pineapple: "#ffec89",
						Date: "#8b3a2c"
					}
					return c[fruit];
				}
	
	
	d3.csv("fruit.csv", function(data) {
			
				data.sort(function(a,b) {return +a.Count - +b.Count;});
				dataset = data;
				xAxis.domain(dataset.map(function(d) { return d.Fruit; }));
				yAxis.domain([0, d3.max(dataset, function(d) { return +d.Count; })]);
				showBarChart();
		});
		function showBarChart(){
		
				var barChart = svg.selectAll(".barChart")
							.data(dataset)
							.enter().append("g")
							.attr('class', "barChart");
							
					barChart.append("rect")
						  .attr("class", "fruitBar")
						  .attr("x", function(d, i) { 
								return i * (fruitBarWidth + fruitBarPadding);
							})
						  .attr("y", height)
						  .attr("width", fruitBarWidth)
						  .attr("fill",function(d){ 
								return color(d.Fruit);
							})
						  .transition().duration(duration)
						  .attr("y", function(d) { 
								return yAxis(+d.Count);
							})
						  .attr("height", function(d) { 
								return height - yAxis(+d.Count);
							});
						  
				 
					barChart.append("text")
						  .attr("class", "fruitName")
						  .attr("fill-opacity", 1)
						  .text(function(d){
								return d.Fruit;
							})
						  .attr("x", function(d, i) {
								return i * (fruitBarWidth + fruitBarPadding);
							})
						  .attr("font-size", fontSize)
						  .attr("y", function(d) { 
								return (height + 25);
							});
							
					barChart.append("text")
						  .attr("class", "fruitCount")
						  .attr("fill-opacity", 1)
						  .text(function(d){
								return +d.Count;
							})
						  .attr("x", function(d, i) {
								return i * (fruitBarWidth + fruitBarPadding);
							})
						  .attr("font-size", fontSize)
						  .attr("y", function(d) { 
								return (height + 15);
							});
			  
				setTimeout(transitionBarToBubble, duration);
		}
		
		function transitionBarToBubble(){
			var barChart = svg.selectAll(".barChart");
			
			barChart.selectAll(".fruitBar")
						 .transition()
						 .duration(duration)
						 .attr("y", height / 2)
						 .attr("height",0);
				
			barChart.selectAll(".fruitName")
						 .transition()
						 .duration(duration)
						 .attr("y", height / 2)
						 .attr("fill-opacity", 0);
			
			barChart.selectAll(".fruitCount")
						 .transition()
						 .duration(duration)
						 .attr("y", height / 2)
						 .attr("fill-opacity", 0);
			setTimeout(showBubbleChart, duration / 2 );
			setTimeout(removeBarChart, duration);
		}
		
		function removeBarChart(){
			svg.selectAll(".barChart").remove();
		}
		
		function showBubbleChart(){
			var nextX = 0;
		
			var bubbleChart = svg.selectAll(".bubbleChart")
							     .data(dataset)
							     .enter().append("g")
							     .attr('class', "bubbleChart");
							
			nextX = 0;
			
			bubbleChart.append("text")
				       .attr("class", "fruitName")
				       .text(function(d){
							return d.Fruit;
						})
					   .attr("x", function(d, i) {
							if (i == 0){
								nextX = ((+d.Count + 10)) * 2 + 10;
								return ((+d.Count + 10)*2);
							} else {
								var x = nextX + (+d.Count + 10) * 2;
								nextX += ((+d.Count + 10)) * 2 + 10;
								return x;
							}
						})
						.attr("y", function(d, i) { 
							if(i % 2 === 0)
								return ((height / 2) - +d.Count - 15);
							else
								return ((height / 2) + +d.Count + 20);
						})
						.attr("font-size", fontSize)
						.attr("fill-opacity", 0)
						.transition().duration(duration)
						.attr("fill-opacity", 1)
						
			nextX = 0;
				
			bubbleChart.append("circle")
					   .attr("class", "fruitBubble")
					   .attr("cx", function(d, i){ 
							if (i == 0){
								nextX = ((+d.Count + 10)) * 2 + 10;
								return ((+d.Count + 10)*2);
							} else {
								var x = nextX + (+d.Count + 10) * 2;
								nextX += ((+d.Count + 10)) * 2 + 10;
								return x;
							}
						})
						.style("fill", function(d){return color(d.Fruit);})
						.attr("cy",  height / 2)
						.attr("r", 0)
						.transition().duration(duration)
						.attr("r", function(d){ return (+d.Count + 10);});
				  
				 
				 
			bubbleChart.append("text")
					   .attr("class", "fruitCount")
					   .text(function(d){ return d.Count;})
					   .attr("x", function(d, i) {
							if (i == 0){ 
								nextX = ((+d.Count + 10)) * 2 + 10;
								return ((+d.Count + 10)*2);
							} else {
								var x = nextX + (+d.Count + 10) * 2;
								nextX += ((+d.Count + 10)) * 2 + 10;
								return x;
							}
						})
						.attr("font-size", fontSize)
						.attr("y", height / 2)
						.attr("fill-opacity", 0)
						.transition().duration(duration)
						.attr("fill-opacity", 1);
		 
			
			setTimeout(transitionBubbleToDonut, duration);
		}
		
		function transitionBubbleToDonut(){
			var bubbleChart = svg.selectAll(".bubbleChart");
			
			bubbleChart.selectAll(".fruitBubble")
					   .transition().duration(duration)
					   .attr("cx", width / 2)
					   .attr("r", 10);
				
			bubbleChart.selectAll(".fruitName")
					   .transition().duration(duration)
					   .attr("x", width / 2)
					   .attr("font-size","0px");
			 
			bubbleChart.selectAll(".fruitCount")
					   .transition().duration(duration)
					   .attr("x", width / 2)
					   .attr("font-size","0px"); 
				
			setTimeout(showDonutChart, duration);
			setTimeout(removeBubbleChart, duration);
		}
		
		function removeBubbleChart(){
			svg.selectAll(".bubbleChart").remove();
		}
		
		function showDonutChart(){
			arc = d3.arc()
						.outerRadius(120)
						.innerRadius(100);
			var donut = d3.pie()
						.sort(null)
						.value(function(d) { return d.Count; })
		
			var donutChart = svg.selectAll(".donutChart")
					   .data(donut(dataset))
					   .enter().append("g")
					   .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")")
					   .attr("class","donutChart");
			var donutPath = donutChart.append("path")
									  .attr("d", arc)
									  .style("fill", function(d) { return color(d.data.Fruit); })
									  .each(function(d) { this._current = d; })
									  .attr("class","path");
			donutChart.append("text")
					  .attr("class", "fruitName")
					  .attr("font-size",fontSize)
					  .text(function(d) { return d.data.Fruit; })
					  .attr("transform", function(d) { return "translate(" + 0 + ")rotate(" + angle(d) + ")"; })	   
					  .transition().duration(duration)
					  .attr("transform", function(d) {return "translate(" + (arc.centroid(d)) + ")rotate(" + angle(d) + ")"; });
					  
					  
			donutPath.transition().duration(duration)
					 .attrTween("d", function(a) {
							var i = d3.interpolate(this._current, a),
							k = d3.interpolate(arc.outerRadius()(), 180);
							this._current = i(0);
							return function(t) {
								return arc.innerRadius(k(t)/2).outerRadius(k(t))(i(t));
							};
					 });
		 
			setTimeout(transitionDonutToBubble,duration * 2);	
		}
	
	function angle(d) {
		var a = (d.startAngle + d.endAngle) * 90 / Math.PI - 90;
		return a;
    }
	
	function transitionDonutToBubble()
	{
		var donutChart = svg.selectAll(".donutChart");
		
		donutChart.selectAll(".path")
				  .transition().duration(duration)
				  .attrTween("d", function(a) {
						var i = d3.interpolate(this._current, a),
						k = d3.interpolate(arc.outerRadius()(), 10);
						this._current = i(0);
						return function(t) {
							return arc.innerRadius(k(t)/2).outerRadius(k(t))(i(t));
						};
					});
		
		donutChart.selectAll(".fruitName")
				  .transition().duration(duration)
				  .attr("transform", function(d) { return "translate(" + 0 + ")rotate(" + angle(d) + ")"; })
				  .attr("font-size","0px");
		setTimeout(showReverseBubbleChart,duration);
		setTimeout(removeDonutChart,duration * 2);
	}
	
	function removeDonutChart(){
		svg.selectAll(".donutChart").remove();
	}
	
	function showReverseBubbleChart()
	{
		var nextX = 0;
		
		var bubbleChart = svg.selectAll(".bubbleChart")
						.data(dataset)
						.enter().append("g")
						.attr('class', "bubbleChart");
							
		nextX = 0;
		
		bubbleChart.append("text")
				   .attr("class", "fruitName")
				   .text(function(d){
						return d.Fruit;
					})
					.attr("font-size", fontSize)
					.attr("y", function(d, i) { 
						if(i % 2 === 0)
							return ((height / 2) - +d.Count - 15);
						else
							return ((height / 2) + +d.Count + 20);
					})
					.attr("x", width / 2)
					.attr("fill-opacity", 0)
				    .transition().duration(duration)
				    .attr("fill-opacity", 1)
					.attr("x", function(d, i) {
						if (i == 0){ 
							nextX = ((+d.Count + 10)) * 2 + 10;
							return ((+d.Count + 10)*2);
						} else {
							var x = nextX + (+d.Count + 10) * 2;
							nextX += ((+d.Count + 10)) * 2 + 10;
							return x;
						}
					})
						
		nextX = 0;
		
		bubbleChart.append("circle")
				   .attr("class", "fruitBubble")
				   .attr("cx", width / 2)
				   .attr("r", 0)
				   .attr("cy",  height / 2)
				   .transition().duration(duration)
				   .attr("cx", function(d, i){
						if (i == 0){ 
							nextX = ((+d.Count + 10)) * 2 + 10;
							return ((+d.Count + 10)*2);
						} else {
							var x = nextX + (+d.Count + 10) * 2;
							nextX += ((+d.Count + 10)) * 2 + 10;
							return x;
						}
					})
				  .attr("r", function(d){ return (+d.Count + 10);})
				  .style("fill", function(d){return color(d.Fruit);});
				 
				 
		bubbleChart.append("text")
			       .attr("class", "fruitCount")
				   .text(function(d){
					return d.Count;
					})
				   .attr("x", function(d, i) {
						if (i == 0){
							nextX = ((+d.Count + 10)) * 2 + 10;
							return ((+d.Count + 10)*2);
						} else {
							var x = nextX + (+d.Count + 10) * 2;
							nextX += ((+d.Count + 10)) * 2 + 10;
							return x;
						}
					})
				   .attr("font-size", fontSize)
				   .attr("y",height / 2)
				   .attr("fill-opacity", 0)
				   .transition().duration(duration * 2)
				   .attr("fill-opacity", 1);
		setTimeout(transitionBubbleToBar,duration);
	}
	
	function transitionBubbleToBar()
	{
		var bubbleChart = svg.selectAll(".bubbleChart");
			
		bubbleChart.selectAll(".fruitBubble")
			 .transition().duration(duration) 
			 .attr("r", 5)
			 .attr("cy",height)
			 .attr("height", function(d) { 
					return height - yAxis(+d.Count);
			 });
				
		bubbleChart.selectAll(".fruitName")
			 .transition().duration(duration)
			 .attr("y",height + 25)
			 .attr("font-size", "0px");
			 
		bubbleChart.selectAll(".fruitCount")
			 .transition().duration(duration)
			 .attr("y",height + 15)
			 .attr("font-size", "0px"); 		
		
		setTimeout(showBarChart,duration);
		setTimeout(removeBubbleChart,duration);
	}
	
</script>
